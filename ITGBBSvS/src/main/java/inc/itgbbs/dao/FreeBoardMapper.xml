<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper   
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"   
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Board">
	<select id="selectList" parameterType="map" resultType="FreeBoardDTO">

		SELECT X.rnum, X.*
		FROM (
		SELECT rownum as rnum, A.*
		FROM (
		SELECT * FROM board
		where category=0
		ORDER BY anum desc) A
	<![CDATA[
			where rownum <= #{end}) X
		WHERE X.rnum >= #{start} 
	]]>
	</select>

	<select id="selectCount" parameterType="map" resultType="Integer">
		SELECT count(*) FROM board
		<where> category=0
		</where>
	</select>

	<!--최대값 구하기 데이터가 없으면 0을 반환 X NullPointerException반환 -->
	<select id="getNewSeq" resultType="int">
		select max(anum) from board
	</select>

	<!-- 글쓰기 -->
	<insert id="insertBoard" parameterType="FreeBoardDTO">
		insert into board(anum,writer,category,adate,ip,title,acontent)
		values(#{anum},#{writer},#{category},#{adate},#{ip},#{title},#{acontent})
	</insert>
	
	<!--글상세보기  -->
	<select id="selectBoard" parameterType="int" resultType="FreeBoardDTO" >
		select * from board where anum=#{anum}
	</select>
	
	<!--조회수 증가  -->
	<update id="updateHit" parameterType="int">
		update board set readcount=readcount+1 where anum=#{anum}
	</update> 
	
	<!--글수정하기  -->
	<update id="updateBoard" parameterType="FreeBoardDTO">
		update board set writer=#{writer}, title=#{title}, acontent=#{acontent} where anum=#{anum}
	</update>

	<!--글삭제하기  -->
	<delete id="deleteBoard" parameterType="int">
		delete from board where anum=#{anum}
	</delete>
	
	<!--답글달기  -->
	<insert id="insertReply" parameterType="FreeBoardDTO">
		insert into board(anum,writer,category,adate,ip,title,acontent,pnum)
		values(#{anum},#{writer},#{category},#{adate},#{ip},#{title},#{acontent},#{pnum})
	</insert>
	
	<!--답글출력  -->
	<select id="repliesList" parameterType="int" resultType="FreeBoardDTO" >
		select * from board where pnum=#{anum} order by anum asc
	</select>
	
	<!--답글 갯수확인  -->
	<select id="getReplyCount" parameterType="int" resultType="int">
		select count(*) from board where pnum=#{pnum}
	</select>
	
</mapper>







